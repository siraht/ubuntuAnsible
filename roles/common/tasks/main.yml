---
- name: Include variables
  include_vars:
    dir: vars

- name: Install curl and gnupg
  become: true
  apt:
    pkg:
      - curl
      - gnupg

- include: add-repos.yml

- name: Update repos and upgrade all packages
  become: true
  apt:
    update_cache: true
    upgrade: yes
    autoremove: true
    cache_valid_time: 3600

- include: install-packages.yml

- include: install-w-scripts.yml

- name: Finish docker installation
  become: true
  shell: |
    newgrp docker
    sudo usermod -aG docker $USER
    sudo systemctl enable docker.service
    sudo systemctl enable containerd.service
    docker run -d -p 9001:9001 --name portainer_agent --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker/volumes:/var/lib/docker/volumes portainer/agent:latest
